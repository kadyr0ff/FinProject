<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4" lang="en">
<head>
    <title></title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
</head>
<body style="margin: 20px">
<div class="nav">
    <h1>ToDo List</h1>
</div>
<div class="divTable" style="margin: 20px 50px 20px 50px">
    <h4>Current tasks</h4>
    <table class="table">
        <thead>
        <tr>
            <th style="width: 3%" scope="col">ID</th>
            <th style="width: 27%" scope="col">Description</th>
<!--            <th style="width: 7%" scope="col">Assignee</th>-->
            <th style="width: 5%" scope="col">Origin Branch</th>
            <th style="width: 5%" scope="col">Origin City</th>
            <th style="width: 5%" scope="col">Destination Branch</th>
            <th style="width: 5%" scope="col">Destination City</th>
            <th style="width: 10%" scope="col">Status</th>
            <th style="width: 15%" scope="col">Change Date</th>
            <th style="width: 15%" scope="col">Action</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="task : ${tasks}">
            <th scope="row"><span th:text="${task.getId()}"> </span></th>
            <td><span th:text="${task.getDescription()}"> Description </span></td>
            <td><span th:each="branch : ${branches}" th:if="(${branch.getId()} == ${task.getOriginBranchId()})"
                      th:text="${branch.getName()}"> Origin Branch ID</span></td>
            <td><span th:each="city : ${cities}" th:if="(${city.getId()} == ${task.getOriginCityId()})"
                      th:text="${city.getName()}"> Origin City ID</span></td>
            <td><span th:each="branch : ${branches}" th:if="(${branch.getId()} == ${task.getDestinationBranchId()})"
                      th:text="${branch.getName()}"> Destination Branch ID</span></td>
            <td><span th:each="city : ${cities}" th:if="(${city.getId()} == ${task.getDestinationCityId()})"
                      th:text="${city.getName()}"> Destination City ID</span></td>
            <td><span th:text="${task.getStatus()}">Status</span></td>
            <td><span th:text="${task.getChangeDate()}"> Created Date </span></td>
            <td>
                <a sec:authorize="hasRole('ADMIN')" class="btn btn-primary btn-sm"
                   th:href="@{/tasks/{id}/edit(id=${task.getId()})}">Update</a>
                <span> </span>
                <a th:if="(${!task.getStatus().equals('Completed')})" sec:authorize="hasRole('ADMIN')" class="btn btn-danger btn-sm"
                   th:href="@{/tasks/{id}/delete(id=${task.getId()})}">Delete</a>
                <span> </span>
                <a th:if="(${!task.getStatus().equals('Completed')})" sec:authorize="hasRole('USER')" class="btn btn-primary btn-sm"
                   th:href="@{/tasks/{id}/complete(id=${task.getId()})}">Complete</a>
                <span> </span>
                <a th:if="(${task.getStatus().equals('Completed')})" class="btn btn-success btn-sm">Completed</a>
            </td>
        </tr>
        </tbody>
    </table>
</div>
<br/>
<div class="divCreate" style="margin: 20px 50px 20px 50px">
    <a sec:authorize="hasRole('ADMIN')" class="btn btn-primary" href="/tasks/new">Create a new Task</a>
    <a class="btn btn-primary" href="/cities">Show cities</a>
    <a class="btn btn-primary" href="/branches">Show branches</a>
</div>
<div th:replace="fragments/footer :: footer"></div>
</body>
</html>